<!--
@license
Copyright (c) 2015 The Polymer Project Authors. All rights reserved.
This code may only be used under the BSD style license found at http://polymer.github.io/LICENSE.txt
The complete set of authors may be found at http://polymer.github.io/AUTHORS.txt
The complete set of contributors may be found at http://polymer.github.io/CONTRIBUTORS.txt
Code distributed by Google as part of the polymer project is also
subject to an additional IP rights grant found at http://polymer.github.io/PATENTS.txt
-->

<link rel="import" href="..\..\bower_components/polymer/polymer.html">

<dom-module id="slot-list">
  <style>
    :host {
      display: block;
    }

    paper-card {
      width: 100%;
    }
  </style>
  <template>


    <loading-placeholder loading-status="{{loading}}"></loading-placeholder>

    <template is="dom-repeat" items="{{dateList}}">
      <paper-card heading="{{item.date}}">
        <div class="card-content">
          <template is="dom-repeat" items="{{slotList}}">
            <paper-card>
              <div class="card-content">
                From:
                <span>{{item.startTime}}</span>
                Until:
                <span>{{item.endTime}}</span>
            </paper-card>
          </template>
      </paper-card>
    </template>
    <!-- <paper-dialog id="slotDialog" modal role="dialog" entry-animation="scale-up-animation" exit-animation="fade-out-animation">
      <paper-dialog-scrollable>
        <template is="dom-repeat" items="{{slotList}}">

          <paper-item>

            <paper-item-body class="paper-item-body-0">

              <paper-button id="docentbutton" flat dialog-confirm on-click="edit">
                <span>{{item.firstName}}</span>
                <span>{{item.lastName}}</span>
              </paper-button>

            </paper-item-body>

          </paper-item>


        </template>
      </paper-dialog-scrollable>
      <div class="buttons">
        <paper-button flat dialog-dismiss>Cancel</paper-button>

      </div>
    </paper-dialog> -->
  </template>
  <script>
    (function() {
      Polymer({
        is: 'slot-list',

        properties: {
          loading: {
            type: Boolean
          },
          slotList: {
            type: Array,
          },
        },
        observers: [
          'slotListChanged(slotList.splices)'
          // ,'docentListChanged(docentList.splices)'
        ],
        slotListChanged: function(changeRecord) {
          if (changeRecord) {

            changeRecord.indexSplices.forEach(function(s) {
              s.removed.forEach(function(room) {});
            }, this);
          }
        },
        ready: function() {
          var self = this;
          Parse.Cloud.run('singleDocent', {
            email: "korbi87@gmail.com"
          }, {
            success: function(result) {

              console.log("docent", result);
              Parse.Cloud.run('dateList', {
                docent: result
              }, {
                success: function(results) {

                  console.log("dates", results);
                  var List = [];
                  for (i in results) {
                    var item = {};
                    var object = results[i];
                    var slots = object.get('Slots');
                    item["date"] = object.get("date");

                    item["slots"] = slots;
                    List.push(item);

                  }
                  List.sort();
                  self.dateList = List;
                  self.loading = !self.loading;
                  var sList = [];
                  for (j in self.dateList) {
                    var singleSlot = {};
                    var date = self.dateList[j];
                    singleSlot["date"] = date.date;
                    // console.log(date.date);
                    var slots = date.slots;
                    for (k in slots) {
                      var x = slots[k];
                      for (l in x) {
                        var y = x[l];

                        singleSlot["startTime"] = y.startTime;
                        singleSlot["endTime"] = y.endTime;
                        singleSlot["available"] = y.availability;

                        // console.log(singleSlot);
                      }

                    }
                  }
                  self.slotList = sList;
                },
                error: function(error) {}
              });

            },
            error: function(error) {}
          });

          console.log("ready");


        }

      });
    })();
  </script>
</dom-module>

<dom-module id="login-element">


  <style type="text/css">
    paper-material {
      width: 70%;
      margin: 0 auto;
      padding: 0 0 20px;
    }

    paper-input-container {
      padding: 0 20px 0 20px !important;
    }

    paper-button {
      width: 90%;
      display: block;
      margin-top: 30px;
      margin-left: auto;
      margin-right: auto;
    }

    #login {
      margin-top: 30px;
    }

    paper-toast {
      z-index: 10;
      right: 50%;
      width: 60%;
    }
  </style>
  <template>



    <paper-material hidden="{{!hidden}}">
      <paper-header-panel class="">
        <paper-toolbar>
          <div>
            <h2>Bitte einloggen</h2>
          </div>
        </paper-toolbar>
      </paper-header-panel>
      <paper-input-container>
        <label>Email</label>
        <input is="iron-input" name="name" type="username" required>
      </paper-input-container>
      <paper-input-container>
        <label>Password</label>
        <input is="iron-input" name="password" name="name" type="password" required>
      </paper-input-container>



      <div id="center">
        <paper-button class="submitButton" raised on-click="handleClick">Anmelden</paper-button>
      </div>

      <div id="center1">
        <paper-button class="submitButton" raised on-click="registerClick">Registrieren</paper-button>
      </div>
    </paper-material>
    <!-- <paper-button raised on-click="test">toast</paper-button> -->
    <div id="signup" hidden="{{hidden}}">
      <signup-element></signup-element>
    </div>
    <paper-toast id="loggedInToast" duration="6000">
      <iron-icon icon="done"></iron-icon>
      <span>Successfully logged in</span>
    </paper-toast>
  </template>

</dom-module>

<script>
  (function() {
    var currentUser = Parse.User.current();
    if (currentUser) {
      (function() {

      })();
    } else {

    }

    Polymer({
      is: "login-element",

      properties: {
        hidden: {
          type: Boolean,
          value: true,
          notify: true
        },
        username: {
          type: String
        },
        password: {
          type: String
        }
      },
      registerClick: function() {
        this.hidden = !this.hidden;
      },
      ready: function() {

      },
      test: function() {
        this.$.loggedInToast.show();
      },

      handleClick: function() {
        var self = this;
        // console.log('click', this);
        var
          username = $('[name="name"]').val().toLowerCase(),
          password = $('[name="password"]').val();


        // Call Parse Login function with those variables
        Parse.User.logIn(username, password, {
          // If the username and password matches
          success:

            function(user) {


            var currentUser = Parse.User.current();

            // if(currentUser.get("emailVerified")){
            if (currentUser) {
              (function() {

                var inputs, index;

                inputs = document.getElementsByTagName('input');


                for (index = 0; index < inputs.length; ++index) {
                  inputs[index].val = '';
                }

                if (currentUser.get("isTeacher")) {
                  document.location.href = "/dozent.html";
                }
                if (currentUser.get("isAdmin")) {
                  document.location.href = "/admin.html";
                } else if (currentUser.get("isAdmin") === false && currentUser.get("isTeacher") === false) {
                  document.location.href = "/user.html";
                } else {
                  // document.location.href = "/#!";
                  self.$.loggedInToast.show();

                  $(self).ready(function() {
                    setTimeout(function() {
                      window.location.reload();
                    }, 1000);

                  });

                }
              })();
            } else {

            }

          },
          // If there is an error
          error: function(user, error) {
            console.log(error);
            alert('Error!');
          }
        });
        $.wait = function(ms) {
          var defer = $.Deferred();
          setTimeout(function() {
            defer.resolve();
          }, ms);
          return defer;
        };

      }
    });
  })();
</script>

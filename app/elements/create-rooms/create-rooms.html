<!--
@license
Copyright (c) 2015 The Polymer Project Authors. All rights reserved.
This code may only be used under the BSD style license found at http://polymer.github.io/LICENSE.txt
The complete set of authors may be found at http://polymer.github.io/AUTHORS.txt
The complete set of contributors may be found at http://polymer.github.io/CONTRIBUTORS.txt
Code distributed by Google as part of the polymer project is also
subject to an additional IP rights grant found at http://polymer.github.io/PATENTS.txt
-->

<link rel="import" href="..\..\bower_components/polymer/polymer.html">

<dom-module id="create-rooms">
  <style>
    :host {
      display: block;
    }

    #button {
      padding-bottom: 20px;
    }
    paper-button {
      width: 30%;
      display: block;
      margin-top: 30px;
      margin-left: auto;
      margin-right: auto;
    }
    paper-material {
      width: 80% !important;
      margin: 0 auto;
    }

    paper-toolbar {
      width: 80% !important;
      margin: 0 auto;
    }


  </style>
      <div class="" hidden="{{!isAdmin}}">
  <template>
    <paper-toolbar id="createDocentToolbar">
      <h2>Create a new Room</h2>
    </paper-toolbar>

    </paper-toolbar>
    <paper-material>

      <paper-item>
        <paper-item-body three-line class="paper-item-body-0">

          <paper-input-container>
            <label>Room Name</label>
            <input is="iron-input" name="roomName" type="text" value="{{roomName::input}}" required>
          </paper-input-container>

          <paper-input-container>
            <label>Building</label>
            <input is="iron-input" name="roomDesc" type="text" value="{{roomDesc::input}}">
          </paper-input-container>

          <paper-input-container>
            <label>Description</label>
            <input is="iron-input" name="roomBuild" type="text" value="{{roomBuild::input}}">
          </paper-input-container>

        </paper-item-body>
      </paper-item>
      <div id="button">
        <div id="button-create">
          <paper-button class="submitButton" autovalidate center-center raised on-click="handleClick">Create</paper-button>
        </div>
      </div>
    </paper-material>
    <paper-dialog id="alertDialog" modal role="dialog" entry-animation="scale-up-animation" exit-animation="fade-out-animation">

      <paper-header-panel>
        <paper-toolbar>
          <div>
            <h2>Missing Information</h2>
          </div>
        </paper-toolbar>
      </paper-header-panel>

      A room needs to have a unique name.

    </paper-dialog>
</div>
  </template>
</template>
  <script>
    (function() {
      Polymer({
        is: 'create-rooms',

        properties: {
          isAdmin: {
            type: Boolean,
            notify: true,
            value: false
          }
        },
        ready: function(){
          var currentUser = Parse.User.current();
          if (currentUser.get("isAdmin")) {
            this.isAdmin = true;
            console.log(this.isAdmin);
          } else {
            console.log(this.isAdmin);
          }
        },
        handleClick: function(e) {
          var model = e.model;
          console.log(model);
          var
            roomName = $('[name="roomName"]').val(),
            roomDesc = $('[name="roomDesc"]').val(),
            roomBuild = $('[name="roomBuild"]').val()

          if (
            roomName === ''
          ) {

            this.$.alertDialog.toggle();


          } else {

            var Room = Parse.Object.extend("Room");
            var room = new Room();

            room.set("roomName", roomName);
            room.set("roomDesc", roomDesc);
            room.set("roomBuild", roomBuild);
            room.set("available", true);

            room.save(null, {
              success: function(room) {
                // Execute any logic that should take place after the object is saved.
                alert('New room created with objectId: ' + room.id);
                var inputs, index;

                inputs = document.getElementsByTagName('paper-input');
                for (index = 0; index < inputs.length; ++index) {
                  inputs[index].val = '';
                }
              },
              error: function(room, error) {
                // Execute any logic that should take place if the save fails.
                // error is a Parse.Error with an error code and message.
                alert('Failed to create new object, with error code: ' + error.message);
              }
            });

          }

        }
      });
    })();
  </script>
</dom-module>

<!--
@license
Copyright (c) 2015 The Polymer Project Authors. All rights reserved.
This code may only be used under the BSD style license found at http://polymer.github.io/LICENSE.txt
The complete set of authors may be found at http://polymer.github.io/AUTHORS.txt
The complete set of contributors may be found at http://polymer.github.io/CONTRIBUTORS.txt
Code distributed by Google as part of the polymer project is also
subject to an additional IP rights grant found at http://polymer.github.io/PATENTS.txt
-->

<link rel="import" href="..\..\bower_components/polymer/polymer.html">

<dom-module id="docent-list-user">
  <style>
    :host {
      display: block;
    }

    paper-item {
      position: relative;
      cursor: pointer;
    }

    paper-dialog {
      width: 100% !important;
      height: 150% !important;
    }

    paper-card {
      margin: 0 auto;
      position: relative;
      width: 100%;
    }

    iron-icon.dismiss {
      position: absolute;
      right: 16px;
    }

    .dismiss:hover {
      cursor: pointer;
    }

    .dismiss:hover iron-icon {
      fill: rgb(157, 157, 157);
    }

    iron-icon:hover {
      fill: rgb(157, 157, 157);
      cursor: pointer;
    }
  </style>
  <template>
    <paper-card hidden="{{dismissed}}">

      <div class="card-content">
        Logged in as:
        <span>{{userName}}</span>
        <iron-icon class="dismiss" icon="icons:close" on-tap="dismissUser"></iron-icon>
      </div>

    </paper-card>

    <div hidden="{{!loggedIn}}">
      <paper-material elevation="1">
        <paper-header-panel>
          <paper-toolbar>
            <div>
              <h2>Select a docent</h2>
            </div>
          </paper-toolbar>
        </paper-header-panel>


        <loading-placeholder loading-status="{{loading}}"></loading-placeholder>
        <!-- <div hidden="{{slotsDismissed}}"> -->

        <!-- <paper-card class="dismiss" on-tap="dismissSlots">
            <paper-ripple fit></paper-ripple>
            <div class="card-content">
              <span>Hide Slots</span>
              <iron-icon icon="arrow-drop-up" on-tap="dismissSlots"></iron-icon>
            </div>

          </paper-card> -->

        <!-- </div> -->

        <div id="dlist">
          <template is="dom-repeat" items="{{docentList}}">


            <paper-item>
              <paper-button on-click="toggleTest">
                <iron-icon icon="expand-more"></iron-icon>

              </paper-button>
              <paper-item-body three-line class="paper-item-body-0">
                <!-- <paper-ripple fit></paper-ripple> -->
                <div>

                  <h4>
                    <span>{{item.lastName}}</span>
                    <span>{{item.firstName}}</span>
                  </h4>

                </div>
                <div secondary><b>Email:</b>
                  <span>{{item.email}}</span>
                </div>
                <div secondary><b>Room:</b>
                  <span>{{item.room}}</span>
                </div>

                <iron-collapse id="{{computeID(item.firstName, item.lastName)}}">

                  <slot-list curr-user="{{usr}}" clicked-docent="{{clickDocent}}"></slot-list>

                </iron-collapse>
              </paper-item-body>

              </paper-icon-item>

          </template>
        </div>

    </div>
    <div hidden="{{loggedIn}}">
      <login-element id="login-element" login-status="user"></login-element>
    </div>

  </template>
  <script>
    (function() {
      Polymer({
        is: "docent-list-user",
        properties: {
          clickDocentID: {
            type: String,
          },

          slotsDismissed: {
            Type: Boolean,
            value: true
          },
          storage: {
            type: Object
          },
          currUser: {
            type: Object,

            notify: true,
          },
          clickedDocent: {
            type: Object,
            notify: true
          },
          loggedIn: {
            type: Boolean,
            value: true
          },
          userName: {
            type: String,
            notify: true
          },
          usr: {
            type: Object,
            notify: true
          }
        },
        computeID: function(first, last) {
          var id = first.toLowerCase() + last.toLowerCase();
        return id;
      },
        initializeDefault: function() {

          this.storage = {};

          console.log(this.storage);
        },
        // use path set api to propagate changes to localstorage
        makeModifications: function() {

          var docent = teacher;
          this.storage[docent] = teacherMail;
          console.log("a", this.storage);
          // this.set('storage.docent', docent);
        },
        dismissSlots: function() {
          this.slotsDismissed = !this.slotsDismissed;
        },
        toggleTest: function(e) {
          var model = e.model;
          var id = model.get("item.firstName").toLowerCase()+model.get("item.lastName").toLowerCase();
          console.log(id);

          document.querySelector('#'+id).toggle();

          var user = Parse.User.current();
          if (user === null) {
            this.loggedIn = !this.loggedIn;

          } else {
            this.slotsDismissed = false;
            // var model = e.model;
            var cDocent = model.get("item.docentObject");
            this.clickDocent = cDocent;
            this.clickedDocentID = cDocent.get("firstName");
            // document.querySelector("#" + this.clickedDocentID).toggle();
          console.log(this.clickedDocentID);
          }

          teacherFirstName = model.get("item.firstName");
          teacherLastName = model.get("item.lastname");
          teacherMail = model.get("item.email");


        },
        ready: function() {

          var user = Parse.User.current();
          this.currentUser = user;
          if (user != null) {
            var name = user.get("firstName") + " " + user.get("lastName");

            this.notifyPath("userName", name);
            // this.notifyPath("currUser", user);
            this.usr = user;
          } else {
            this.dismissed = !this.dismissed;
          }

          var self = this;
          var teacherFirstName, teacherLastName, teacherMail;
          var teacherFirstName, teacherLastName, teacherMail;
          Parse.Cloud.run('docentList', {
            status: "user"
          }, {
            success: function(result) {

              self.loading = !self.loading;
              self.docentList = result;
              console.log(result);
            },
            error: function(error) {}
          });

        },
        dismissUser: function(e) {
          this.dismissed = !this.dismissed;
        },

        docentClick: function(e) {
          console.log("docentClicked");


          // var user = Parse.User.current();
          // if (user === null) {
          //   this.loggedIn = !this.loggedIn;
          //
          // } else {
          //   this.slotsDismissed = false;
          //   var model = e.model;
          //   var cDocent = model.get("item.docentObject");
          //   this.clickDocent = cDocent;
          //   this.clickedDocentID = cDocent.get("firstName");
          //   // document.querySelector("#" + this.clickedDocentID).toggle();
          // console.log(this.clickedDocentID);
          // }
          //
          //
          // console.log(currentUser);
          //
          // teacherFirstName = model.get("item.firstName");
          // teacherLastName = model.get("item.lastname");
          // teacherMail = model.get("item.email");




        }
      });
    })();
  </script>
</dom-module>
